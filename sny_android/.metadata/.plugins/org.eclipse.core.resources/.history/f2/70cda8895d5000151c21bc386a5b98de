package swc.sny.activity;

import java.io.BufferedReader;
import java.io.IOException;
import java.io.InputStreamReader;
import java.io.PrintWriter;
import java.net.Socket;

import swc.test.sockettest.R;
import android.app.Activity;
import android.content.SharedPreferences;
import android.os.Bundle;
import android.util.Log;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.Button;
import android.widget.EditText;
import android.widget.TextView;

public class ConnectActivity extends Activity {

	private Socket socket; // ????????????
	BufferedReader in; // ??????????????? ??? ???????????? ?????????.
	PrintWriter out; // ????????? ???????????? ????????????.
	EditText editIp; // ????????????
	Button connectBtn; // ????????????
	TextView output; // ????????????
	String data; //

	@Override
	protected void onCreate(Bundle savedInstanceState) { // ??? ????????? ???????????????
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_connect);

		// start
		editIp = (EditText) findViewById(R.id.connect_edit_ip); // ?????????????????? ?????????.
		connectBtn = (Button) findViewById(R.id.connect_btn); // ????????? ?????????.
		output = (TextView) findViewById(R.id.connect_output); // ?????????????????? ?????????.
		
		
		

		// ????????? ????????? ????????? ??????, ????????? ??????????????? ????????? ????????? ?????? ????????? ????????????. ???????????? ???????????? ????????? ??????????????????
		// ???????????? ???????????? ???????????? ???????????? ????????????.
		connectBtn.setOnClickListener(new OnClickListener() {
			public void onClick(View v) {
				// ????????? ???????????? ????????? ???????????? ????????????.
				String strIp = editIp.getText().toString();
				// ?????????????????? ?????? ????????? // String ????????? ????????? // data??? ??????
				Log.w("NETWORK", " " + strIp);
				if (strIp != null) { // ?????? ???????????? ???????????? ????????? ?????? ????????????
					out.println(strIp); // data??? stream ????????? ???????????? ??????. ??????????????? ????????????
										// ?????? ??????.
					SharedPreferences pref = getSharedPreferences(
							"pref", MODE_PRIVATE);
					SharedPreferences.Editor editor = pref.edit();
					editor.putString("ip_address", strIp);
					editor.commit();
				}
			}
		});

		Thread worker = new Thread() { // worker ??? Thread ??? ??????
			public void run() { // ????????? ????????????
				try {
					// ????????? ???????????? ????????? ???????????? ????????? ????????????.
					socket = new Socket("175.214.92.110", 5555); // ????????????
					out = new PrintWriter(socket.getOutputStream(), true);
					// ???????????? // ????????? // stream // ????????? // ???????????? //????????????.
					in = new BufferedReader(new InputStreamReader(
							socket.getInputStream())); // ????????? ????????? stream??? ???????????????.

				} catch (IOException e) {
					e.printStackTrace();
				}

				// ???????????? ???????????? ????????? ????????? ????????????.
				try {
					while (true) {
						data = in.readLine();
						// in?????? ?????? ???????????? String ????????? ?????? data ??? ??????
						Log.i("****data", data);

						output.post(new Runnable() {
							public void run() {
								output.setText(data); // ?????????????????? ????????? ?????? ???????????? ?????????.
							}
						});
					}
				} catch (Exception e) {
					e.printStackTrace();
				}
			}
		};

		worker.start(); // onResume()?????? ??????.

	}

	@Override
	protected void onStop() { // ??? ?????????
		super.onStop();
		try {
			socket.close(); // ????????? ?????????.
		} catch (IOException e) {
			e.printStackTrace();
		}
	}

	// private Socket server;
	// Button btnTest, btnSaveIp;
	// EditText editText;
	// TextView textView1, textView2;
	// String strIp;
	// private OutputStream outputStream;
	// private Socket client;
	// private FileInputStream fileInputStream;
	// private BufferedInputStream bufferedInputStream;
	//
	// File file = new File("/storage/emulated/0/test/1.wav");
	//
	// @Override
	// protected void onCreate(Bundle savedInstanceState) {
	// super.onCreate(savedInstanceState);
	// setContentView(R.layout.activity_socket_test);
	//
	// init();
	//
	// btnSaveIp.setOnClickListener(new View.OnClickListener() {
	// @Override
	// public void onClick(View v) {
	// strIp = editText.getText().toString();
	//
	// }
	// });
	//
	// btnTest.setOnClickListener(new View.OnClickListener() {
	// public void onClick(View v) {
	// if (strIp != null) {
	// textView1.setText("File Sent clicked");
	// NetworkTask myClientTask = new NetworkTask();
	// myClientTask.execute();
	// } else {
	// textView1.setText("put the ip");
	// }
	// }
	// });
	// }
	//
	// public class NetworkTask extends AsyncTask<Void, Void, Void> {
	// @Override
	// protected Void doInBackground(Void... arg0) {
	// try {
	// // textView2.setText("File Sent trying");
	// // IP Address and port number
	// // Insert your PC's IP address
	// // You can get your IP address by cmd, inserting ipconfig
	// // LAN connection are essential
	//
	// client = new Socket(strIp, 9000);
	// Toast.makeText(SocketTestActivity.this, strIp, 0).show();
	// byte[] mybytearray = new byte[(int) file.length()]; // create
	// // a
	// // byte
	// // array
	// // to
	// // file
	//
	// // File inserted from directory you chose above
	// fileInputStream = new FileInputStream(file);
	// bufferedInputStream = new BufferedInputStream(fileInputStream);
	//
	// bufferedInputStream.read(mybytearray, 0, mybytearray.length); // read
	// // the
	// // file
	//
	// // Input file converted to Output file
	//
	// // Preparing to send output
	// outputStream = client.getOutputStream();
	//
	// outputStream.write(mybytearray, 0, mybytearray.length); // write
	// // file to the output stream byte by byte
	//
	// // Closing bufferinput, server or client
	// outputStream.flush();
	// bufferedInputStream.close();
	// outputStream.close();
	// client.close();
	//
	// textView2.setText("File Sent complete");
	//
	// } catch (UnknownHostException e) {
	// e.printStackTrace();
	// } catch (IOException e) {
	// e.printStackTrace();
	// }
	// return null;
	// }
	// ????????? ??? ?????? ????????????.....????????????????????????????????????????????????????????????????????? ???????????? ?????????????????????
	//
	// }
	//
	// private void init() {
	// btnSaveIp = (Button) findViewById(R.id.btnSaveIp);
	// btnTest = (Button) findViewById(R.id.btnTest);
	// editText = (EditText) findViewById(R.id.editText1);
	// textView1 = (TextView) findViewById(R.id.textView1);
	// textView2 = (TextView) findViewById(R.id.textView2);
	// }
}
